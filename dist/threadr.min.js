/**
 * Threadr.js v0.0.1-b1407312225
 * https://github.com/bbuecherl/Threadr
 * License: MIT http://bbuecherl.mit-license.org/ */
var Threadr=function(){var blockOpen="{",blockClose="}",emptyString="",undef="undefined",typeObj="object",typeStr="string",typeFunct="function",isWorkerSupport=typeof window.Worker!==undef,isWebsocketSupport=typeof window.Worker!==undef,isIndexeddbSupport=typeof window.indexedDB!==undef,ajax=function(a,b,c){function d(a){if(f=!1,window.XMLHttpRequest)f=new XMLHttpRequest,f.overrideMimeType&&f.overrideMimeType("text/json");else if(window.ActiveXObject)try{f=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{f=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}}return f?(f.onreadystatechange=e,f.open("GET",a,!0),f.setRequestHeader("Content-type","text/plain"),void f.send(null)):!1}function e(){g&&4==f.readyState&&(b(200==f.status?f.responseText:null),window.clearTimeout(g))}var f=!1,g=window.setTimeout(function(){b(null),g=!1,f&&f.abort()},c||5e3);d(a)},emitter=function(a){var b={};return a.on=function(c,d){return(b[c]=b[c]||[]).push(d),a},a.off=function(c,d){var e,f=b[c]||[];if("function"==typeof d){for(;(e=f.indexOf(d))>-1;)f.splice(e,1);b[c]=f}else b[c]=[];return a},function(c,d){var e=b[c]||[],f=e.length;for(d=d||[];f>0;)e[--f].apply(a,d)}},ThreadWorker=function(){if(isWorkerSupport)return window.Worker;var WorkerSandbox,makeSandboxScope=function(target){var nativeSetI=window.setInterval,nativeSetT=window.setTimeout,intervalTasks=[],timeoutTasks=[],$closing=!1;target.atob=window.atob,target.btoa=window.btoa,target.setInterval=function(){$closing||intervalTasks.push(nativeSetI.apply(window,arguments))},target.setTimeout=function(){$closing||timeoutTasks.push(nativeSetT.apply(window,arguments))},target.clearInterval=function(a){var b=intervalTasks.indexOf(a);-1!==b&&(window.clearInterval(a),intervalTasks.splice(b,1))},target.clearTimeout=function(a){var b=timeoutTasks.indexOf(a);-1!==b&&(window.clearTimeout(a),timeoutTasks.splice(b,1))},target.terminate=function(a){if("get"===a)return $closing;for(var b=0;b<intervalTasks.length;++b)window.clearInterval(intervalTasks[b]);for(b=0;b<timeoutTasks.length;++b)window.clearTimeout(timeoutTasks[b]);$closing=!0},target.load=function(scripts,callback){"string"==typeof scripts&&(scripts=[scripts]);for(var i=0,len=scripts.length,loaded=0;i<scripts.length;++i)ajax(scripts[i],function(data){try{eval(data),loaded++}catch(e){target.$threadr__error(e)}loaded===len-1&&callback()})}};return function(){WorkerSandbox=function(){makeSandboxScope(this),this.$threadr__init=function(a,b){this.location=document.location.href;var c=[],d=[],e={window:this,self:this,document:void 0,top:void 0,history:void 0,parent:void 0,frames:void 0,forms:void 0,source:void 0,pa:void 0,terminate:this.terminate,on:this.on,off:this.off,post:this.post,load:this.load,location:this.location,setTimeout:this.setTimeout,setInterval:this.setInterval,clearTimeout:this.clearTimeout,clearInterval:this.clearInterval,atob:this.atob,btoa:this.btoa,Threadr:Threadr};for(var f in b)c.push(f),d.push(b[f]);for(f in e)-1===c.indexOf(f)&&(c.push(f),d.push(e[f]));try{var g=Function.apply(null,c.concat(a));g.apply(this,d)}catch(h){this.$threadr__error(h)}}}}(),function(){var a=new WorkerSandbox,b=this,c=emitter(a);a.post=function(c,d){"function"!=typeof b.onmessage||a.terminate("get")||b.onmessage({data:{name:c,args:d}})},a.$threadr__error=function(c){"function"!=typeof b.onerror||a.terminate("get")||b.onerror(c)},this.postMessage=function(b){if(!a.terminate("get"))if(b.threadr)switch(b.threadr){default:return}else c(b.name,b.args)},this.terminate=function(){a.terminate()}}}(),Thread=function(){var a=function(){var a=0;return function(){return a++}}(),b=function(a){var b=a.toString().split(blockOpen);return b.shift(),b=b.join(blockOpen).split(blockClose),b.pop(),b.join(blockClose)};return function(c,d,e){var f=!1,g=new ThreadWorker(Threadr.url),h=this,i=!1;d.push(this),this.running=!1,this.id=a(),this.childs=[],this.start=function(a){return this.running||(this.running=!0,Threadr.count++,g.$threadr_init?g.$threadr_init(src,typeof a===typeObj&&null!==a?a:{}):(i=b(c),g.postMessage({threadr:"init",source:i,params:typeof a===typeObj&&null!==a?a:{},loc:document.location.href,count:Threadr.count,id:this.id}))),this},this.clone=function(){return new Thread(c,d)},this.terminate=function(){return this.running&&(g.terminate(),Threadr.count--),this},this.post=function(a,b){return this.running&&g.postMessage({threadr:"post",name:a,args:b}),this},e?this.emit=function(a){f=a}:f=emitter(this),g.onmessage=function(a){var b;if(a.data.threadr)switch(a.data.threadr){case"post":f(a.data.name,a.data.args);break;case"suppost":h.childs[a.data.id].post(a.data.name,a.data.args);break;case"spawn":var c=h.childs.length;b=new Thread(a.data.source,h.childs,!0),g.postMessage({threadr:"spawned",id:c,tid:b.TID}),b.emit(function(a,b){g.postMessage({threadr:"subpost",id:c,name:a,args:b})}),h.childs.push(b);break;case"start":h.childs[a.data.id]instanceof Thread&&h.childs[a.data.id].start(a.data.params)}},g.onerror=function(a){f("error",[a])}}}(),Threadr=function(){var a=[],b={spawn:function(b){return new Thread(b,a)},terminateAll:function(){for(var b=0;b<a.length;++b)a[b].terminate()},count:0,url:"runnable.js",supports:{worker:isWorkerSupport,websocket:isWebsocketSupport,indexeddb:isIndexeddbSupport}};return b}();return Threadr}();